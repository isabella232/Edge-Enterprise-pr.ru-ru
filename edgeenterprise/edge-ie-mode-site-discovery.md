---
title: Пошаговое руководство по Enterprise Site Discovery
ms.author: collw
author: appcompatguy
manager: saudm
ms.date: 04/29/2022
audience: ITPro
ms.topic: conceptual
ms.prod: microsoft-edge
ms.localizationpriority: medium
ms.collection: M365-modern-desktop
description: Руководство по использованию Enterprise site Discovery для подготовки к режиму IE.
ms.openlocfilehash: e2199637d7f52236bd98a2692ac3d008d2e2837c
ms.sourcegitcommit: 592f6e40b13e28af588473b2a75c3ae697e5db2d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2022
ms.locfileid: "12505662"
---
# <a name="enterprise-site-discovery-step-by-step-guide"></a>Пошаговое руководство по Enterprise Site Discovery

>[!Note]
> Поддержка классического приложения Internet Explorer 11 будет прекращена 15 июня 2022 г. (список области применения см. в [вопросах и ответах](https://techcommunity.microsoft.com/t5/windows-it-pro-blog/internet-explorer-11-desktop-app-retirement-faq/ba-p/2366549)). Те же приложения и сайты IE11, которые вы используете сегодня, можно открывать в Microsoft Edge в режиме Internet Explorer. Дополнительные сведения см. [здесь](https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/).

В этой статье представлено пошаговое руководство по использованию средства Enterprise Site Discovery в Microsoft Endpoint Configuration Manager.

> [!TIP]
> Если ваша среда не требует выполнения действий, описанных в этом руководстве, рекомендуется использовать мастер [](https://aka.ms/edgeadvisor) развертывания Microsoft Edge и скрипт, который он создает для настройки Enterprise Site Discovery.

Enterprise Site Discovery помогает настроить список сайтов в режиме предприятия. Enterprise Site Discovery помогает:

- Обнаруживать сайты, использующие устаревшие режимы документов. Если эти сайты не обнаруживают современные браузеры и не содержат другие элементы HTML, им, скорее всего, потребуется использовать режим IE.
- Обнаруживать сайты, использующие элементы ActiveX. Microsoft Edge не поддерживает элементы ActiveX. Если эти сайты не обнаруживают современные браузеры и не содержат другие элементы HTML, им, скорее всего, потребуется использовать режим IE.

> [!NOTE]
> Эта статья относится к Microsoft Edge версии 77 или более поздней; каналы **Stable**, **Beta** и **Dev**.

## <a name="prerequisites"></a>Предварительные условия

В этом руководстве предполагается, что вы опытный пользователь Microsoft Endpoint Configuration Manager, и у вас установлены следующие службы и роли:

- Microsoft Endpoint Configuration Manager
- Службы отчетов Microsoft SQL Server Reporting Services
- (Необязательно) Configuration Manager Reporting Services настроена роль точки

## <a name="download-enterprise-site-discovery-tools"></a>Скачивание набора средств Enterprise Site Discovery

Скачайте следующие средства:

- [Пакет установки и настройки Enterprise Site Discovery](https://go.microsoft.com/fwlink/p/?LinkId=517719)
- [Построитель отчетов для Майкрософт](https://www.microsoft.com/download/details.aspx?id=53613)

## <a name="enable-enterprise-site-discovery"></a>Включение Enterprise Site Discovery

Прежде чем подключиться к Windows management Instrumentation (WMI) для получения данных обнаружения сайтов, необходимо развернуть поставщик класса WMI на устройстве, которое собирает эти данные.

Из **пакета установки и настройки Enterprise Site Discovery** извлеките содержимое в папку файлового ресурса определенной библиотеки программного обеспечения. Пример: **\\\\DSL\\EnterpriseSiteDiscovery**.

Затем создайте пакет в Microsoft Endpoint Configuration Manager, как описано в разделе "Пакеты и программы[" Configuration Manager](/configmgr/apps/deploy-use/packages-and-programs).

Настройте новый пакет со следующими параметрами:

- На странице **"Пакет** ":
  - выберите **имя** и укажите имя **Enable Site Discovery**
  - Выберите **этот пакет, содержащий исходные файлы**
  - укажите исходную папку, в которую вы извлекли файлы (например, **\\\\DSL\\EnterpriseSiteDiscovery**).
- На странице **Тип программы** выберите **Стандартная программа**
- На странице **"Стандартная программа** " введите следующую команду, чтобы настроить обнаружение сайтов на устройстве:

  ```dos
  
    powershell.exe -ExecutionPolicy Bypass .\IETelemetrySetUp-Win8.ps1

  ```

  > [!NOTE]
  > Скрипт поддерживает использование параметров командной строки для `-ZoneAllowList` и `-SiteAllowList`. Для этого пошаговые инструкции мы настроим эти параметры с помощью [групповой политики](#configure-enterprise-site-discovery-via-group-policy).

- На странице **стандартной программы** :
  - Выберите параметр для запуска **Hidden**
  - в **разделе "Программа может выполняться**" выберите параметр , вошел ли пользователь **в систему**

После создания пакета дважды щелкните его имя **Включение обнаружения сайтов**, чтобы просмотреть его свойства. В поле **"После запуска** " выберите " **Configuration Manager перезапускает компьютер"**. Сбор данных WMI начнется после перезагрузки устройств.

> [!NOTE]
> Вы можете настроить интервал времени, в течение которого пользователю нужно перезапустить устройство, как описано в [документации по параметрам клиента](/configmgr/core/clients/deploy/about-client-settings#computer-restart).

Чтобы убедиться, что сбор данных работает, посетите несколько веб-сайтов и выполните следующую команду PowerShell, чтобы убедиться, что данные заполняются в пространстве имен WMI.

```powershell

Get-WmiObject -Namespace “root/cimv2/IETelemetry” -Class IEURLInfo | Select-Object URL, NumberOfVisits, CrashCount, DocMode | Sort-Object

```

## <a name="configure-enterprise-site-discovery-via-group-policy"></a>Настройка средства Enterprise Site Discovery с помощью групповой политики

Если средство Enterprise Site Discovery включено, вы можете указать, какие данные нужно собирать. Рассмотрите местные законы и нормативные требования, как описано в разделе ["Какие данные собираются?"](/internet-explorer/ie11-deploy-guide/collect-data-using-enterprise-site-discovery#what-data-is-collected).

1. Откройте редактор групповых политик.
2. Выберите **computer** **ConfigurationAdministrative** >  Templates  > **Windows ComponentsInternet** >  **Explorer**.
3. Дважды **щелкните "Включить выходные данные WMI обнаружения сайтов"**.
4. Выберите **Включено**.
5. Нажмите **кнопку "** ОК **" или "** Применить", чтобы сохранить этот параметр политики.

Вы можете выбрать зоны, в которых требуется собирать данные сайта:

1. Дважды щелкните **"Ограничить выходные данные обнаружения сайтов по зоне"**.
2. Выберите **Включено**.
3. **Задайте маску зоны**, чтобы указать, для каких из следующих зон следует включить обнаружение сайтов.

    - Зона ограниченных сайтов
    - Зона Интернета
    - Зона надежных сайтов
    - Зона локальной интрасети
    - Зона локального компьютера
   > [!NOTE]
   > Чтобы настроить зоны, включенные в обнаружение сайтов, двоичное число формируется на основе выбранных зон. Десятичное представление этого числа используется для представления этого числа в политике.

    Примеры: маска зоны 2: **00010** будет собирать данные только для зоны локальной интрасети, только маска зоны 6: **00110** будет собирать данные только для зон интрасети и надежных сайтов.

4. Нажмите **кнопку "** ОК **" или "** Применить", чтобы сохранить этот параметр политики.

Вы также можете ограничить домены, для которых собираются данные сайта:

1. Дважды щелкните **"Ограничить выходные данные обнаружения сайтов по домену"**.
2. Выберите **Включено**.
3. Введите домены, для которых требуется собрать данные, по одному домену на строку.
4. Нажмите **кнопку "** ОК **" или "** Применить", чтобы сохранить этот параметр политики.

## <a name="collect-site-discovery-data-using-configuration-manager"></a>Сбор данных обнаружения сайтов с помощью Configuration Manager

Теперь, когда ваши устройства создают данные, пора собирать эти данные в Configuration Manager.

1. В консоли Configuration Manager **выберите AdministrationClient** >  **Параметры** >  **Default Client Параметры**.
2. В группе **свойств** на вкладке " **Главная** " выберите **"Свойства"**.
3. В **диалоговом окне Параметры** клиента по умолчанию выберите "**Инвентаризация оборудования"**.
4. В **списке Параметры** устройства выберите "**Задать классы"**.
5. В **диалоговом окне** "Классы инвентаризации оборудования" нажмите кнопку **"Добавить"**.
6. В **диалоговом окне "** Добавление класса инвентаризации оборудования **" выберите Подключение**.
7. В диалоговом окне **Подключение к инструментарию управления Windows (WMI)** введите имя компьютера, на котором настроено средство Enterprise Site Discovery. Если вы подключаетесь к другому компьютеру, вам потребуются учетные данные с разрешениями на доступ к WMI.
8. В **текстовом поле пространства имен WMI** введите **root\cimv2\IETelemetry**.
9. Выберите **Подключение**.
10. В диалоговом окне "Добавление класса инвентаризации оборудования****" в списке классов инвентаризации выберите классы WMI **IESystemINfo**, **IEUrlInfo** и **IECountInfo**.****
11. Нажмите **кнопку "** ОК" **, чтобы закрыть диалоговое** окно "Квалификаторы классов" и другие открытые диалоги.

После того как обновлены параметры клиента из точки управления, данные будут добавляться в отчет при следующем запуске инвентаризации оборудования (по умолчанию каждые семь дней).

## <a name="import-site-discovery-reports"></a>Импорт отчетов об обнаружении сайтов

Пакет Enterprise Site Discovery включает два примера отчетов. В одном отчете отображаются сайты, использующие ActiveX, а в отчете — сайты с устаревшими режимами документов.

### <a name="configure-the-site-discovery-sample-report"></a>Настройка примера отчета об обнаружении сайтов

Используйте инструкции в качестве руководства для создания примера отчета, использующего три источника данных. Эти источники данных: сайты, которые посещает пользователь, сведения о системе и режимы документов, используемые сайтами. Этот отчет помогает определить сайты, которые могут зависеть от устаревших режимов документов.

1. Скопируйте отчет **SCCM_Report-Site_Discovery.rdl** на свой сервер Configuration Manager.
2. Установите [Построитель отчетов для Майкрософт](/sql/reporting-services/install-windows/install-report-builder).
3. Дважды щелкните **SCCM_Report-Site_Discovery.rdl**, чтобы открыть отчет в Построителе отчетов.
4. При первом открытии отчета он попытается связаться с сервером, на котором он был создан. При появлении запроса **Подключение на сервер отчетов** выберите "**Нет"**.
5. После открытия отчета разверните **Источники данных** и дважды щелкните **DataSource1**.
6. В **окне "Свойства источника данных**" выберите **"Использовать подключение, внедренное в** отчет", а затем нажмите кнопку **"Сборка".**

> [!NOTE]
> Убедитесь, что Microsoft SQL Server в качестве источника данных. Report Builder по умолчанию Microsoft SQL Server analysis Services в качестве источника данных.

7. В окне **Свойства подключения** выберите **Имя сервера** и введите имя сервера Configuration Manager. Затем в разделе **Выберите или введите имя базы данных** выберите имя базы данных Configuration Manager из раскрывающегося списка.
8. Нажмите **кнопку "** ОК", чтобы закрыть **окно "Свойства подключения** ".
9. Выберите **"Проверить подключение** ", чтобы проверить подключение. Если подключение успешно установлено, нажмите кнопку **"** ОК", чтобы закрыть **окно свойств источника** данных.
10. Повторите шаги с 5 по 9 для **источника данных 2**.
11. Разверните **Наборы данных** и дважды щелкните **DataSet1**.
12. В **окне "Свойства набора данных** " щелкните текстовое поле **"Запрос:** " Скопируйте запрос в Блокнот и найдите и **замените** CM_A1B именем базы данных, выбранным на шаге 7. Вставьте обновленный запрос в **текстовое поле Query:** (Запрос: ).
13. Повторите действия 11–12 для **DataSet2**, **DataSet3** и **DataSet4**.
14. На **вкладке "** Главная" ленты **нажмите кнопку** "Выполнить", чтобы протестировать отчет.
15. Сохраните отчет и закройте microsoft Report Builder.
17. Переименуйте файл отчета **в Site Discovery.rdl**

### <a name="configure-the-activex-sample-report"></a>Настройка примера отчета ActiveX

Выполните следующую процедуру, чтобы создать пример отчета, использующего один источник данных: сайты, применяющие элементы ActiveX. Так как Internet Explorer — это единственный браузер, который ActiveX элементов управления, для этих сайтов может потребоваться режим IE в Microsoft Edge.

1. Скопируйте отчет **SCCM Report Sample - ActiveX.rdl** на свой сервер Configuration Manager.
2. Установите [Построитель отчетов для Майкрософт](/sql/reporting-services/install-windows/install-report-builder).
3. Дважды щелкните **SCCM Report Sample - ActiveX.rdl**, чтобы открыть отчет в Построителе отчетов.
4. При первом открытии отчета он попытается связаться с сервером, на котором он был создан. При появлении запроса **Подключение на сервер отчетов** выберите "**Нет"**.
5. После открытия отчета разверните **Источники данных** и дважды щелкните **AutoGen__5C6358F2_4BB6_4a1b_A16E_8D96795D8602_**.
6. В **окне "Свойства источника данных**" выберите **"Использовать подключение, внедренное в** отчет", а затем нажмите кнопку **"Сборка".**
7. В окне **Свойства подключения** выберите **Имя сервера** и введите имя сервера Configuration Manager. Затем в разделе **Выберите или введите имя базы данных** выберите имя базы данных Configuration Manager из раскрывающегося списка.
8. Нажмите **кнопку "** ОК", чтобы закрыть **окно "Свойства подключения** ".
9. Выберите **"Проверить подключение** ", чтобы проверить подключение. Если подключение установлено успешно, нажмите **кнопку "** ОК", чтобы закрыть **окно свойств источника** данных.
10. Разверните **Наборы данных** и дважды щелкните **DataSet1**.
11. В **окне "Свойства набора данных** " щелкните текстовое поле **"Запрос:** " Скопируйте запрос в Блокнот и найдите и **замените** CM_A1B именем базы данных, выбранным на шаге 7. Вставьте обновленный запрос в **текстовое поле Query:** (Запрос: ).
12. На **вкладке "** Главная" ленты **нажмите кнопку** "Выполнить", чтобы протестировать отчет.
13. Сохраните отчет.
14. Закройте Построитель отчетов для Майкрософт.
15. Измените имя файла на **ActiveX**.

### <a name="upload-configured-reports-to-microsoft-sql-server-reporting-services"></a>Отправка настроенных отчетов в службы отчетов Microsoft SQL Server Reporting Services

После настройки отчетов для своей среды отправьте их на сервер отчетов.

1. Запустите приложение **Диспетчер конфигурации Reporting Services**.
2. В **окне подключения к серверу** отчетов **выберите Подключение** url-адрес, указанный в разделе **"Идентификация сайта веб-портала"**.
3. В открываемом окне браузера на странице SQL Server Reporting Services **** выберите папку ConfigMgr_SCCMSiteCode для кода сайта SCCM.****
4. На ленте наведите указатель **мыши на кнопку +Создать** и выберите пункт **меню "Папка** ".
5. Введите имя папки, например **Enterprise Site Discovery**, а затем нажмите кнопку **"Создать**".
6. Выберите **папку Enterprise Site Discovery**.
7. На ленте **нажмите кнопку** Upload.
8. Выберите отчет **об обнаружении сайтов** и нажмите кнопку **"ОК"**.
9. Повторите шаги 7 и 8 для отчета **ActiveX**.

### <a name="view-reports-in-configuration-manager"></a>Просмотр отчетов в Configuration Manager

После настройки и отправки отчетов вы можете просмотреть их в Configuration Manager.

1. В консоли Configuration Manager выберите **Мониторинг** > **Создание отчетов** > **Отчеты** > **Enterprise Site Discovery**.
2. Дважды щелкните отчет, чтобы просмотреть его.

## <a name="disable-enterprise-site-discovery"></a>Отключение Enterprise Site Discovery

Завершив сбор данных, отключите Enterprise site Discovery. Создайте второй пакет, чтобы отключить Enterprise site Discovery в Microsoft Endpoint Configuration Manager, как описано в пакетах и [программах в Configuration Manager](/configmgr/apps/deploy-use/packages-and-programs). Настройте следующие параметры:

- На странице **"Пакет** ":
  - Выберите **"Имя** " и укажите имя **"Отключить обнаружение сайтов"**.
  - Выберите **этот пакет, содержащий исходные файлы**.
  - укажите исходную папку, в которую вы извлекли файлы (например, **\\\\DSL\\EnterpriseSiteDiscovery**).
- На странице **"Тип программы** " выберите **стандартную программу**.
- На странице **"Стандартная программа** " введите следующую командную строку, чтобы отключить обнаружение сайтов на устройстве:

  ```dos
  powershell.exe -ExecutionPolicy Bypass .\IETelemetrySetUp-Win8.ps1 -IEFeatureOff

  ```

- На странице **стандартной программы** :
  - Выберите параметр run **Hidden** .
  - в **разделе "Программа может выполняться**" выберите параметр, в который вошел **пользователь**.

## <a name="see-also"></a>См. также

- [Целевая страница Microsoft Edge Enterprise](https://aka.ms/EdgeEnterprise)
- [Сведения о режиме IE](./edge-ie-mode.md)
- [Дополнительные сведения о режиме предприятия](/internet-explorer/ie11-deploy-guide/enterprise-mode-overview-for-ie11)
- [Дополнительные сведения об Enterprise Site Discovery](/internet-explorer/ie11-deploy-guide/collect-data-using-enterprise-site-discovery)
